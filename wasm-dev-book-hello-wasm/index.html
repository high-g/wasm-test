<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>Hello, Wasm!!</title>
  </head>
  <body>
    <script>
      const imports = {
        env: {
          date_now: Date.now,
        },
      }

      const wasm = './target/wasm32-unknown-unknown/release/wasm_dev_book_hello_wasm.wasm'

      const toUnit32 = (num) => num >>> 0

      // const importObject = { imports: { imported_func: (arg) => console.log(arg) } }

      WebAssembly.instantiateStreaming(fetch(wasm), imports).then((results) => {
        console.log('results', results)
        const { add, get_timestamp, rand } = results.instance.exports
        console.log(add(1, 2))
      })

      fetch(wasm)
        .then((response) => response.arrayBuffer())
        .then((bytes) => WebAssembly.instantiate(bytes, imports))
        .then((results) => {
          const { add, get_timestamp, rand } = results.instance.exports
          console.log(add(1, 2))
          console.log('get_timestamp()', get_timestamp())
          console.log('rand', toUnit32(rand()))
        })

      function js_add(num1, num2) {
        return num1 + num2
      }
    </script>
  </body>
</html>
